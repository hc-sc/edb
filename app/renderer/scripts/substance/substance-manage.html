<section layout-fill layout='row'>
    <md-sidenav class="md-sidenav-left md-whiteframe-z2" md-component-id="left" md-is-locked-open="$mdMedia('gt-sm')">
        <md-toolbar class="md-whiteframe-z1" layout="row">
            <div class="md-toolbar-tools">
                <md-button class="md-icon-button" aria-label="Home" ng-href="#/home" ng-click="_ctrl.confirmLeavePage($event)">
                    <md-icon class="material-icons" aria-label="Home">home</md-icon>
                </md-button>
                <h2>
          <span>Substances</span>
        </h2>
            </div>
        </md-toolbar>
        <md-input-container style="margin-bottom:0">
            <label>Substance</label>
            <input name="substanceName" ng-model="_ctrl.filterText" ng-change="_ctrl.filterSubstance()">
        </md-input-container>
        <md-content>
            <md-list>
                <!-- notice work around for nedb. 'track by index'' to fix $$hashkey problem -->
                <md-list-item ng-repeat="it in _ctrl.substances track by $index" ng-click="_ctrl.selectSubstance(it, $index)">
                    <md-icon class="material-icons" aria-label="Substance">business</md-icon>
                    <p>{{it.SUBSTANCE_NAME}}</p>
                    <md-divider ng-if="!$last"></md-divider>
                </md-list-item>
            </md-list>
        </md-content>
    </md-sidenav>

    <div layout-fill layout='column' tabIndex='-1' role='main' class='md-whiteframe-z2'>
        <md-toolbar layout="row" class="md-whiteframe-z1">
            <div class="md-toolbar-tools">                
                <md-button class="md-icon-button" aria-label="Legal Entities" ng-click="_ctrl.toggleSidenav('left')" hide-gt-sm>
                    <md-icon class="material-icons" aria-label="Legal Entity">business</md-icon> 
                </md-button>
                <h2> {{ _ctrl.selected.SUBSTANCE_NAME }}</h2>
             </div>                
        </md-toolbar>
        <md-content layout-padding>
            <form name='substanceForm' id='substanceForm'>
                <div layout-gt-xs='row'>
                    <md-input-container class='md-block' flex-gt-sm>
                        <label for='identifier'>Identifier</label>
                        <input ng-model='_ctrl.selected._identifier' name='identifier' type='text' disabled />
                    </md-input-container>
                    <md-input-container class='md-block' flex-gt-sm>
                        <label for='pid'>PID</label>
                        <input ng-model='_ctrl.selected.SUBSTANCE_PID' name='pid' type='text' disabled />
                    </md-input-container>
                </div>
                <div layout-gt-sm='row'>
                    <md-input-container class='md-block' flex-gt-sm>
                        <label for='name'>Name</label>
                        <input required ng-model='_ctrl.selected.SUBSTANCE_NAME' name='name' type='text' />
                    </md-input-container>
                    <md-input-container class="md-block" flex="20">
                        <label for='repeatSelectStatus'>Status</label>
                        <md-select name='repeatSelectStatus' id="repeatSelectStatus" ng-model='_ctrl.selected.METADATA_STATUS.VALUE' ng-change="_ctrl.updateSelectedStatusDecode()">
                            <md-option ng-repeat="substanceStatus in _ctrl.metadataStatusOptions" value="{{substanceStatus.VALUE}}" ng-selected="{{_ctrl.selected.METADATA_STATUS.VALUE == substanceStatus.VALUE}}">{{ substanceStatus.VALUE_DECODE }}</md-option>
                        </md-select>
                    </md-input-container>
                </div>

                <md-toolbar>
                    <div class='md-toolbar-tools'>
                        <h2>Indentifier</h2>
                        <span flex></span>
                        <md-button class='md-icon-button' ng-click='_ctrl.addSubstanceIdentfier()'>
                            <md-icon class='material-icons' aria-label='Add Substance Identifier'>add_circle</md-icon>
                        </md-button>
                    </div>
                </md-toolbar>
                <md-list>
                    <md-list-item ng-repeat='it in _ctrl.selected.SUBSTANCE_IDENTIFIER track by $index' class='noright'>
                        <div layout-gt-sm='row' flex-gt-sm>
                            <md-input-container class='md-block'>
                                <label>Identifier</label>
                                <input ng-model='it.IDENTIFIER' type="text">
                            </md-input-container>
                            <md-input-container class="md-block">
                                <label>Type</label>
                                <md-select name="repeatSelectIdType" id="repeatSelectIdType" 
                                            ng-model="it.SUBSTANCE_IDENTIFIER_TYPE.VALUE_DECODE"
                                            ng-change="_ctrl.updateIdTypeDecodeByIdentifierIndex($index)">
                                    <md-option ng-repeat="idType in _ctrl.identifierTypeOptions" 
                                        value="{{idType.VALUE}}" 
                                        ng-selected="{{(it.SUBSTANCE_IDENTIFIER_TYPE.VALUE === idType.VALUE)}}">{{ idType.VALUE_DECODE }}</md-option>
                                </md-select>                                    
                            </md-input-container>
                            <md-input-container class='md-block'>
                                <label>Ext. Decode Value </label>
                                <input ng-model='it.SUBSTANCE_IDENTIFIER_TYPE.VALUE_DECODE' type="text">
                            </md-input-container>
                            <md-input-container class='md-block'>
                                <label>Ext. Value</label>
                                <input ng-model='it.SUBSTANCE_IDENTIFIER_TYPE.VALUE.attr$.Other_Value' type="text">
                            </md-input-container>
                            <span flex></span>
                            <md-button class="md-secondary md-raised" ng-click="_ctrl.deleteSubstanceIdentfier(it.IDENTIFIER, $event)">Delete</md-button>
                        </div>
                    </md-list-item>
                </md-list>
            </form>
        </md-content>

        <!-- buttons -->
        <section layout='row' layout-sm='column' layout-align='center' layout-wrap>
            <md-button class='md-raised md-info' ng-click='_ctrl.addSubstance()' aria-label='Add'>Add</md-button>
            <md-button class='md-raised md-primary' ng-click='_ctrl.saveSubstance($event)' aria-label='Save' ng-disabled="substanceForm.$invalid">Save</md-button>
            <md-button class='md-raised md-danger' ng-click='_ctrl.cancelEdit()' aria-label='Cancel'>Cancel</md-button>
            <md-button class='md-raised md-warn' ng-click='_ctrl.deleteSubstance()' aria-label='Delete'>Delete</md-button>
            <md-button class='md-raised md-warn' ng-click='_ctrl.initializeSubstances()' aria-label='init DB'>Initialize DB with sample</md-button>
        </section>
    </div>
</section>